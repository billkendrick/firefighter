# Firefighter

### Version: Alpha

A twin-stick firefighting action game for the Atari 8-bit.

## Credits
By Bill Kendrick <bill@newbreedsoftware.com>  
http://www.newbreedsoftware.com/firefighter/

Inspired by [_Real Heroes: Firefighter_](https://en.wikipedia.org/wiki/Real_Heroes:_Firefighter)
(Wii, Conspiracy Entertainment, 2012),
[_Brave Firefighters_](https://www.arcade-museum.com/game_detail.php?game_id=7212)
(SEGA, arcade, 1999),
[_Boulderdash_](https://en.wikipedia.org/wiki/Boulder_Dash_%28video_game%29)
(Atari 8-bit and other platforms, First Star Software, 1985),
and [_Robotron: 2084_](https://en.wikipedia.org/wiki/Robotron:_2084)
(Williams Electronics, arcade, 1982).

Developed 2023-08-13 - 2023-08-21

------------------------------------------------------------------------

# Story

Fires are breaking out at an industrial building.  It's your job to find
and save the workers trapped inside, and put out fires along the way.

------------------------------------------------------------------------

# Gameplay

## Overview

Each level of the game is made of a single screen containing one or more
rooms to navigate, occupied by crates, barrels of explosive material,
leaking gas pipelines, and workers.

You control a firefighter with an unlimited amount of fire extinguishing
agent (a magic invisible hose? a decanter of endless water? don't think
about it too hard).  Spray the fire to quench it, but beware because it
spreads quickly.

Find the workers trapped in the room, and help them navigate to the exit.
They are overcome by smoke and fear, and will wander aimlessly unless you
are close by to guide them.  They can perish if they end up too close to a
large fire!

Some rooms contain crates and/or barrels which you can push out of
your way if they block your path.  Be careful how you move them, though;
you can only push, you cannot pull them!

Pipes pump gas through some rooms, and any cracks will leak this flammable
material into the air.  If you can reach the valve, you can turn off
the flow.

If there's an ax, you can pick it up.  Instead of pushing crates, you
will destroy them (they may take two hits).  Be careful navigating near
pipes once you have the ax, as you will damage them!

When fire spreads to oil barrels or gas leaking from pipes it will
cause an explosion, spreading even more fire.  Beware of chain reactions!

## Starting the Game

The title screen shows some brief instructions and descriptions of
objects.  Press the `Start` console key or firebutton on either
joystick to begin a game.

You can select which joystick moves the firefighter, and which sprays,
by pressing the `Option` console key.

You can choose a starting level by using the `Select` console key.

## Controls

This game is best played with a dual-stick set-up (a la the arcade games
_Robotron: 2084_ or _Smash TV_).  One stick controls your firefighter's
position in the room, the other causes you to spray; in both cases,
in any one of eight directions.  You may move and spray at the same time
(walking backwards or strafing).

If you prefer to play with only one joystick, you can hold the fire button
and push a direction to spray that way.  However, you will stand still
while you spray!

## Object and Item Descriptions

### The Room

Neither you, nor the workers can move through these objects.
Fire cannot spread into or through these objects.

#### Brick walls

The walls that make up the room(s) in each level.

#### Exit Sign and Door

Walk up to these and push into them, and any workers standing next to
you will leave the room to safety.  (This is the goal of the game!)

Once all workers have left the room (or perished), you can push into
a door or exit leave the room yourself, and thus end the level.
(See "Completing a Level", below.)

#### Gas Pipes and Valves

##### Gas Pipes

Gas pipes which are broken will leak gas, which cause explosions.
Large fire will appear at the gas leak's position, as well as
directly above, below, to the left, and to the right, if possible.

In some levels, gas pipes start out broken.  Beware -- if you have the
ax and walk into a pipe, it will become broken!

##### Valves

Closing all valves connected to pipes will turn off the gas,
which will stop any broken pipes from leaking gas.

Walk up and push into a valve to toggle its state.
Open valves have crossbars that go up and down ("+").
Closed valves have crossbars that go diagonal ("X").

### Movable and Destroyable Objects

There are some objects which you may be able to push around the room.
Walk up and push into them any of eight directions and, if there is
nothing in that direction -- it must be a blank space, there may not
be fire, gas leaks, or workers -- it will move to that position
(you will stay in the same spot for a moment).

#### Crates and Broken Crates

If you have picked up the ax during the current level, when you push
into crates they will become broken crates.  And if you push into
broken crates, they will be completely destroyed.

When fire spreads to crates and broken crates, it starts out as
a large fire immediately!

#### Oil Barrels

When fire spreads to oil barrels, they cause an explosion!
Large fire will appear at the barrel's position, as well as
directly above, below, to the left, and to the right, if possible.

### Workers

Workers are the green, flailing people running around the room.
They normally move randomly, but if you are nearby, they will
tend to move towards you.  Use this behavior to lead them to the
exit.  Stand next to the exit and push your joystick towards a
door or exit sign, and any adjacent workers will be rescued:
they disappear from the room, you'll hear a chime sound, and
you'll receive points.

If a large fire ends up spreading onto a worker, they'll
perish: they disappear from the room, you'll hear a sad tone,
and the screen will flash red.

### Ax

The ax is a collectible object that appear on some levels.
(You start each level without the ax.)  When you touch it, it
will disappear from the room, you'll hear a chime, you'll
receive some points, and the word "AX" will appear at the top right.
(Note: You cannot "unequip" yourself of the ax.)

As described above, the ax can be used to break and destroy crates,
but can also break pipes if you're not careful -- and that can lead
to gas leaks, which lead to explosions, which leads to even more
fire to contend with!

The ax can be destroyed by fire!  When fire spreads onto the ax,
it starts out as a large fire immediately!

### Fire

Each level begins with, at the very least, a small fire somewhere
on the screen.  As the game goes on, small fires will grow into
medium fires, medium fires will grow into large fires, and large
fires will spread into adjacent positions in the room.

Normally, when fire spreads, the new fire will start out small.
However, as described above, when fire spreads onto some objects,
the new fire will start out large.  In some cases, there'll be
an explosion (the screen will flash and an explosion sound will
play), which can cause more large fire to appear adjacent to
whatever caused the explosion!

## Completing a Level

When no more workers remain on the screen -- either by being rescued,
or perishing -- you may exit the level.  This is indicated by a blue
exclamation point appearing at the top left of the screen.

Walk to a door or "Exit" sign and hold the stick in the direction of
the door or sign.  A countdown will appear at the top left.  Once it
reaches zero (0), you will exit the level.

Prior to leaving a level, you should try and put out any remaining
fire and ensure there are no gas leaks, to receive a "safety bonus".

Each level begins with a "Bonus" score that counts down over time.
These points are also added to your score when you complete a level.

## Scoring

* Picking up an ax: 15 points
* Breaking or destroying a crate: -1 point
* Breaking a pipe: -5 points
* Saving a worker: 100 points
* Ending a level with no fire or gas leaks remaining: 1,000 points
* Time bonus: Scoring potental starts at 1,000 x Level # (max 10,000)

------------------------------------------------------------------------

# Development

This game is written (almost) entirely in the C programming language,
and cross-compiled using the [CC65](https://cc65.github.io/)
cross development package for 6502-based systems, such as the Atari 8-bit.

## Inspiration

In 2019 my children were playing a lot of _Real Heroes: Firefighter_ on
the Wii.  In the game you navigate (in a 3D first-person perspective), equip
yourself with tools (ax, hose, etc.), put out fires, and save civilians.
It inspired me to design a game with similar concepts, but as a top-down
twin-stick "shooter", like _Robotron: 2084_.  I have a very nice arcade-style
controller (from Edladdin Controllers) that I use for the Atari 8-bit port
of that game, and needed an excuse to write a twin-stick game.
(Also, this isn't my fire firefighting game; as a kid back in the 1980s I wrote
a game in Atari BASIC where you use a helicopter to put out a fire on a skyscraper.)

Four years later I happened across my copious notes (including some hand-drawn
pixel art) and decided to finally take a stab at it.  I fired up _Envision_
font editor on Linux, and immediately spent too much time designing the shape of
the text characters used in the game, based on the fonts seen on the sides of
firetrucks in the US.  I finally also began adding the in-game objects.

## Graphics

I opted to use ANTIC mode 7 (aka `GRAPHICS 2`), the mode with very large text
(20 characters tall by 12 characters wide), where each character is a single
color, with one of our colors possible, depending on the two high-bits of the
screen data.  This means only 64 shapes are available.  No inverse-video
(inverted pixels) are possible, either.  (Compare to regular 40 by 24 text mode
(aka `GRAHICS 0`), which allows for 128 shapes, plus inverse-video versions.)

However, when setting the `CHBASE` register (or the OS's `CHBAS` shadow) to
tell the Atari where in memory to look for character graphics (the "font"),
it is possible to offset the character set page by two, which causes the
ANTIC 7 parts of the screen to use the *latter* half of the character set.
The small text, ANTIC mode 2 (aka `GRAPHICS 0`) continues to use the full set.
Therefore, while I'm limited to only uppercase characters the small mode 2 text,
and no text at all (only game tile shapes) in the large mode 7 text, this means
I can get away with only a *single* 1KB character set for all of my needs!

In reality, I have two character sets, and flip between them every few frames
(screen refreshes) to get some animation -- fire burning, gas leaks and
water spraying, and workers flailng their limbs.  So in the end, 2KB of space
is used for all of the character data.  (See the `fire1.fnt` and `fire2.fnt`
files in the [`fonts/`](fonts/) subdirectory.)

You'll notice large mode 7 text used to display the "FIREFIGHTER" title at the
top (and other messages between levels during the game).  This is acheived by
_not_ offsetting the character set at first.  Instead, it happens during a
Display List Interrupt (DLI), which also changes some colors in the
palette, including handling the fire and gas leak color cycling.
The font animation happens here, as well -- so any game loop slowdown that may
happen has no effect on these things.

One byte in Page 6 is used to tell the DLI where the font's base is (there may
be a better way of handling this?), and it uses the `RTCLOK` timer register,
updated by the OS each Vertical Blank Interrupt (VBI) to animate.
(Note: I don't use any of my own VBIs in this game.)

Another byte in Page 6 is used to let the DLI change the background color of
the game area, based on events (e.g., flashing when an oil barrel explodes).
(See [`dli.c`](src/dli.c).  Note: This is the only hand-coded
6502 assembly language in this game.  Everything else is in C.)

## Sound

[TBD] Explain how sound works.

## Gameplay

### Cellular Automaton

The game is driven by a
[cellular Automaton](https://en.wikipedia.org/wiki/Cellular_automaton)
routine.  The screen memory of the game area is treated as individual
cells.  Certain kinds of cells have behaviors which can affect their
cell and/or the cells next to them.

#### Fire

For example, a cell that contains a small fire has a random chance
of growing into a medium fire.  Similarly, a medium fire has a chance
to become a large fire.  A cell containing a large fire has a random
chance of spreading in a random direction.

#### Workers

The workers are also treated as cells.  They "move" by placing a blank
shape in their current cell, and a worker in an adjacent cell.
They first observe nearby adjacent cells to see whether the firefighter
is nearby.  If so, they will go that direction; otherwise, they will
pick a random direction.

#### Gas Leaks

Gas leaks are handled as a special case.  If a cell contains the
"open valve" shape, a small routine will attempt to follow any
adjacent pipes (including bending at corners) until no more pipe can
be found.  Any cells containing broken pipes will have gas leak shapes
placed in any blank spots adjacent to them.  Similarly, if a cell
contains the "closed valve" shape, pipes will be followed and any
gas leaks next to broken pipes will be removed.

(Note: This means a single open- or closed-valve shape can take
a much longer time to process.  Another method I'm considering
involves checking the entire game board for any open valves and,
depending on the state of the board, all broken pipes will leak,
or not leak.  That is, the cellular automaton would check broken pipes,
rather than valves.)

#### Water

During the cellular automaton phase, any water on the level is
erased.  This means the main loop only needs to worry about
drawing it while the joystick is being pushed.

### Water Spray

The player may spray water in any of eight directions.
Each direction is made up of four different tile shapes in the
character set (so we're using half of the game tile portion of
our character set just for water spray!  It *is* an important
aspect of the game, however!)

The sprays consists of a narrow point placed directly adjacent
to the firefighter, plus three more that represent the wide end
of the spray.  For the four cardinal directions, the wide spray
is drawn as three vertical or three horizontal shapes in a row.
For the four diagonal directions, the middle of the wide part
continues in the direction of spray, and the two ends appear
perpendicular to it (forming a 2x2 square of shapes).

Examples:

```
.....  .....  .....
.../.  .\-/.  ..|\.
.F<|.  ..V..  ..L-.
...\.  ..F..  .F...
.....  .....  .....
```

If the initial (narrow, adjacent) shape hits an obstacle, or
fire, the other three shapes will not be drawn (and, hence, not
have any affect on fire beyond the position adjacent to the player).

## Levels

Levels are created as plain ASCII text files containing special
(human-readable) characters that represent the handful of various
shapes possible in the game.  (While we have 64 shapes in our character
set to work with, in up to 4 colors each, in reality many shapes are
not part of the map.

See the [levels documentation](levels/README.md) for details.
